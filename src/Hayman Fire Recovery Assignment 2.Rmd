---
title: "Hayman Fire Recovery"
author: "Casey Menick"
date: "01/31/2022"
output:
  pdf_document: default
  html_document: default
---

```{r setup, warning=F,message=F}
library(tidyverse)
library(tidyr)
library(ggthemes)
library(lubridate)

# Now that we have learned how to munge (manipulate) data
# and plot it, we will work on using these skills in new ways

knitr::opts_knit$set(root.dir='..')
```


```{r dataread, warning=F,message=F}
####-----Reading in Data and Stacking it ----- ####
#Reading in files
files <- list.files('../data',full.names=T)


#Read in individual data files
ndmi <- read_csv(files[1]) %>% 
  rename(burned=2,unburned=3) %>%
  mutate(data='ndmi')


ndsi <- read_csv(files[2]) %>% 
  rename(burned=2,unburned=3) %>%
  mutate(data='ndsi')

ndvi <- read_csv(files[3])%>% 
  rename(burned=2,unburned=3) %>%
  mutate(data='ndvi')

# Stack as a tidy dataset
full_long <- rbind(ndvi,ndmi,ndsi) %>%
  gather(key='site',value='value',-DateTime,-data) %>%
  filter(!is.na(value))


```




## Question 1) 

What is the correlation between NDVI and NDMI? - here I want you to
convert the full_long dataset in to a wide dataset using the 
function "spread" and then make a plot that shows the correlation as a
function of if the site was burned or not (x axis should be ndmi)
You should exclude winter months and focus on summer months

```{r dataread, warning=F,message=F}
full_wide <-full_long %>% 
  spread(key="data",value="value") %>% 
  filter(!is.na(ndvi)) %>%
  filter(!is.na(ndsi)) %>%
  filter(!is.na(ndmi)) %>%
  mutate(month=month(DateTime),
         year=year(DateTime)) 

ggplot(full_wide%>%filter(month==c(5,6,7,8,9)),aes(ndmi,ndvi,color=site)) +
  geom_point()

```


## Question 2 

2) What is the correlation between average NDSI (normalized
 snow index) for January - April and average NDVI for June-August?
In other words, does the previous year's snow cover influence vegetation
 growth for the following summer?

```{r dataread, warning=F,message=F}
full_long_season <- full_long %>%
  mutate(month=month(DateTime),
         year=year(DateTime)) %>%
  filter(month %in% c(1,2,3,4,6,7,8),
         data %in% c('ndvi','ndsi')) %>%
  mutate(season=if_else(month %in% c(1,2,3,4),"winter","summer")) %>%
  group_by(season,year,site,data) %>%
  summarize(value=mean(value)) %>%
  ungroup() %>%
  filter(data=="ndvi" & season=="summer" | data=="ndsi" & season=="winter") %>% 
  .[c(1,2,3,5)] %>%
  spread(key="season",value="value")

ggplot(full_long_season,aes(summer,winter,color=site)) +
  geom_point() +
  xlab("Summer (June-Aug) NDVI") + ylab("Winter (Jan-April) NDSI")

```

## Q3

How is the snow effect from question 2 different between pre- and post-burn
and burned and unburned? 

```{r dataread, warning=F,message=F}

full_long_season_status <- full_long_season %>%
  mutate(burnstatus=if_else(year %in% c(1984:2002),"Before 2002 Burn","Post 2002 Burn"))


ggplot(full_long_season_status,aes(summer,winter,color=site)) +
  geom_point() +
  facet_wrap(~burnstatus) +
  xlab("Summer (June-Aug) NDVI") + ylab("Winter (Jan-April) NDSI")
```

## Question 4

What month is the greenest month on average? 

```{r dataread, warning=F,message=F}


```


## Question 5) 

What month is the snowiest on average?
```{r dataread, warning=F,message=F}


```


## Bonus Question: Redo all problems with `spread` and `gather` using modern tidyverse syntax. 

```{r dataread, warning=F,message=F}


```


## Bonus Question: Use Climage Engine to pull the same data for the assignment, but updated with 2020/2021 data.

```{r dataread, warning=F,message=F}


```



